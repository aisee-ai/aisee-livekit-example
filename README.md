# AISee LiveKit Example

An Android application that demonstrates LiveKit integration with accessibility services for real-time audio communication and camera functionality.

## Features

- **Accessibility Service Integration**: Runs as an accessibility service that can operate in the background
- **LiveKit Audio**: Real-time audio streaming using LiveKit WebRTC
- **Microphone Toggle**: F2 key to toggle microphone on/off
- **Camera Capture**: Remote camera capture via RPC calls
- **Auto-start**: Automatically starts after device boot

## Prerequisites

- Android Studio Arctic Fox or later
- Android device with API level 31+ (Android 12+)
- LiveKit server instance
- JWT token for LiveKit authentication

## Installation

### 1. Clone and Setup

```bash
git clone <repository-url>
cd aiseelivekitexample
```

### 2. Configure LiveKit Credentials

Copy the example configuration file:
```bash
cp local.properties.example local.properties
```

Edit `local.properties` with your LiveKit credentials:
```properties
# Android SDK location (usually auto-generated by Android Studio)
sdk.dir=/path/to/android/sdk

# LiveKit Configuration
livekit.wsUrl=wss://your-livekit-server.livekit.cloud
livekit.token=your-jwt-token-here
```

### 3. Build the Application

Open the project in Android Studio and build:
```bash
./gradlew assembleDebug
```

Or build from command line:
```bash
./gradlew build
```

### 4. Install on Device

```bash
./gradlew installDebug
```

## Setup and Configuration

### 1. Enable Accessibility Service

After installation, you need to enable the accessibility service:

1. Go to **Settings** → **Accessibility**
2. Find **AISee LiveKit Example** service
3. Toggle it **ON**
4. Grant the required permissions

### 2. Grant Permissions

The app requires these permissions:
- **Microphone access** - For audio streaming
- **Internet access** - For LiveKit connection
- **Accessibility service** - For background operation

### 3. Auto-start Setup

The app is configured to start automatically after device boot. No additional setup required.

## Usage

### Basic Operation

1. **Launch**: The app starts automatically when the accessibility service is enabled
2. **Connect**: It automatically connects to the configured LiveKit room as "wearable-user"
3. **Audio**: Microphone is enabled by default

### Controls

- **F2 Key**: Toggle microphone on/off
  - When turning mic on, sends "Hi" message to the room
  - Visual feedback through logs

### Remote Camera Capture

The app supports remote camera capture via RPC:

```javascript
// Call from another client in the same LiveKit room
await room.localParticipant.rpcCall("takePhoto", "")
```

This will:
1. Capture a photo using the device camera
2. Save it to device gallery
3. Send the image file to all participants via data stream
4. Return the image URI

## Development

### Project Structure

```
app/src/main/java/com/example/aisee_livekit_example/
├── accessibility/
│   └── LiveKitAccessibilityService.kt  # Main accessibility service
├── boot/
│   └── BootReceiver.kt                 # Auto-start receiver
├── livekit/
│   ├── LiveKitClient.kt               # LiveKit integration
│   ├── LiveKitEvent.kt               # Event handling
│   └── TokenRepository.kt            # Token management
└── MainActivity.kt                    # Main activity (minimal)
```

### Key Components

- **LiveKitAccessibilityService**: Core service that handles LiveKit connection and user interactions
- **LiveKitClient**: Wrapper for LiveKit SDK functionality
- **ConfigTokenRepository**: Manages authentication tokens from BuildConfig
- **BootReceiver**: Ensures service starts after device reboot

### Dependencies

- LiveKit Android SDK v2.23.1
- CameraX for camera functionality
- AndroidX Lifecycle components

## Troubleshooting

### Build Issues

1. **BuildConfig errors**: Ensure `local.properties` exists with valid values
2. **Gradle sync issues**: Use Android Studio's "Sync Project" option
3. **SDK version issues**: Check `compileSdk` and `targetSdk` in `build.gradle.kts`

### Runtime Issues

1. **Service not starting**: 
   - Check if accessibility service is enabled
   - Verify permissions are granted
   - Check logcat for error messages

2. **LiveKit connection fails**:
   - Verify `wsUrl` and `token` in `local.properties`
   - Check internet connectivity
   - Ensure token has correct permissions for the room

3. **Camera capture fails**:
   - Grant camera permissions if prompted
   - Check device has available storage
   - Verify CameraX compatibility

### Logging

Use Android Studio's Logcat with filter `LiveKit` to see detailed operation logs:
```
adb logcat -s LiveKitAccessibilityService
```

## Security Notes

- Never commit `local.properties` to version control
- Use proper JWT tokens with appropriate expiration times
- Consider implementing token refresh mechanism for production use
- Review accessibility service permissions before deployment

## License

[Add your license information here]